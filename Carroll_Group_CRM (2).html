<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carroll Group - Sales CRM Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root{--red:#C00000;--red-dark:#8B0000;--red-light:#E53935;--bg:#0D0D0D;--card:#1A1A1A;--elevated:#242424;--input:#2A2A2A;--text:#FFF;--text2:#A0A0A0;--muted:#666;--border:#333;--success:#00C853;--warning:#FFB300;--info:#29B6F6;--purple:#AB47BC;--orange:#FF7043}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'IBM Plex Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5}
        .header{background:linear-gradient(180deg,var(--card),var(--bg));border-bottom:1px solid var(--border);padding:1rem 2rem;position:sticky;top:0;z-index:100}
        .header-content{max-width:1900px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
        .logo-section{display:flex;align-items:center;gap:1rem}.logo{width:48px;height:48px;background:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.2rem}
        .brand h1{font-size:1.25rem;font-weight:700}.brand span{font-size:.75rem;color:var(--text2);text-transform:uppercase;letter-spacing:.1em}
        .user-info{display:flex;align-items:center;gap:.75rem;color:var(--text2);font-size:.875rem}
        .user-avatar{width:36px;height:36px;background:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;color:#fff}
        .nav-tabs{background:var(--card);border-bottom:1px solid var(--border);padding:0 2rem}.nav-tabs ul{max-width:1900px;margin:0 auto;display:flex;list-style:none;overflow-x:auto}
        .nav-tabs a{display:block;padding:1rem 1.25rem;color:var(--text2);text-decoration:none;font-weight:500;font-size:.8rem;border-bottom:2px solid transparent;white-space:nowrap}
        .nav-tabs a:hover{color:var(--text);background:var(--elevated)}.nav-tabs a.active{color:var(--red-light);border-bottom-color:var(--red)}
        .main-content{max-width:1900px;margin:0 auto;padding:1.5rem 2rem}.tab-content{display:none}.tab-content.active{display:block;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .stats-row{display:grid;grid-template-columns:repeat(6,1fr);gap:1rem;margin-bottom:1.5rem}
        .stat-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem;position:relative;overflow:hidden}
        .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--red)}
        .stat-card.success::before{background:var(--success)}.stat-card.warning::before{background:var(--warning)}.stat-card.info::before{background:var(--info)}.stat-card.purple::before{background:var(--purple)}.stat-card.orange::before{background:var(--orange)}
        .stat-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text2);margin-bottom:.25rem}
        .stat-value{font-size:1.5rem;font-weight:700;font-family:'JetBrains Mono',monospace}.stat-change{font-size:.7rem;margin-top:.25rem}.stat-change.up{color:var(--success)}.stat-change.down{color:var(--red-light)}
        .charts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
        .chart-card{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}.chart-card.wide{grid-column:span 2}
        .chart-header{background:var(--elevated);padding:.75rem 1rem;border-bottom:1px solid var(--border)}.chart-title{font-size:.8rem;font-weight:600;text-transform:uppercase}
        .chart-body{padding:1rem;height:250px}
        .variables-panel{background:var(--card);border:1px solid var(--border);border-radius:8px;margin-bottom:1.5rem}
        .variables-header{background:var(--elevated);padding:.75rem 1rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;cursor:pointer}
        .variables-body{padding:1rem;display:none}.variables-body.open{display:block}
        .variables-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:1rem}
        .var-group label{display:block;font-size:.65rem;text-transform:uppercase;color:var(--text2);margin-bottom:.25rem}
        .var-group input,.var-group select{width:100%;background:var(--input);border:1px solid var(--border);border-radius:4px;padding:.4rem .6rem;color:var(--text);font-size:.8rem;font-family:'JetBrains Mono',monospace}
        .alerts-section{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
        .alert-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem}.alert-card.danger{border-color:var(--red)}.alert-card.warning{border-color:var(--warning)}
        .alert-title{font-size:.75rem;font-weight:600;text-transform:uppercase;margin-bottom:.5rem}.alert-list{max-height:120px;overflow-y:auto}
        .alert-item{padding:.4rem 0;border-bottom:1px solid var(--border);font-size:.8rem;display:flex;justify-content:space-between}.alert-item:last-child{border-bottom:none}
        .goals-section{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem;margin-bottom:1.5rem}
        .goals-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:1rem}.goal-item{text-align:center}
        .goal-label{font-size:.7rem;color:var(--text2);text-transform:uppercase;margin-bottom:.5rem}
        .goal-progress{height:8px;background:var(--elevated);border-radius:4px;overflow:hidden;margin-bottom:.25rem}
        .goal-bar{height:100%;background:var(--red);border-radius:4px}.goal-bar.complete{background:var(--success)}.goal-value{font-size:.75rem;font-family:'JetBrains Mono',monospace}
        .dashboard-bottom{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
        .section-card{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}
        .section-header{background:var(--elevated);padding:.75rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;text-transform:uppercase}
        .section-body{padding:.75rem 1rem;max-height:250px;overflow-y:auto}
        .activity-item{display:flex;gap:.75rem;padding:.5rem 0;border-bottom:1px solid var(--border)}.activity-item:last-child{border-bottom:none}
        .activity-icon{width:28px;height:28px;background:var(--elevated);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem}
        .activity-content{flex:1}.activity-title{font-weight:500;font-size:.8rem}.activity-meta{font-size:.7rem;color:var(--muted)}
        .table-container{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}
        .table-header{background:var(--elevated);padding:.75rem 1rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap}
        .table-title{font-size:1rem;font-weight:600}.table-actions{display:flex;gap:.5rem;flex-wrap:wrap}
        .search-input{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:.4rem .75rem;color:var(--text);font-size:.8rem;width:180px}
        .search-input::placeholder{color:var(--muted)}.table-scroll{overflow-x:auto}table{width:100%;border-collapse:collapse}thead{background:var(--bg)}
        th{padding:.6rem .75rem;text-align:left;font-size:.65rem;font-weight:600;text-transform:uppercase;color:var(--text2);border-bottom:1px solid var(--border);white-space:nowrap}
        td{padding:.6rem .75rem;border-bottom:1px solid var(--border);font-size:.8rem}tbody tr:hover{background:var(--elevated)}
        .badge{display:inline-block;padding:.15rem .5rem;border-radius:20px;font-size:.65rem;font-weight:500;text-transform:uppercase}
        .badge-lead{background:rgba(41,182,246,.2);color:#29B6F6}.badge-qualified{background:rgba(255,179,0,.2);color:#FFB300}.badge-proposal{background:rgba(171,71,188,.2);color:#AB47BC}
        .badge-negotiation{background:rgba(255,112,67,.2);color:#FF7043}.badge-won{background:rgba(0,200,83,.2);color:#00C853}.badge-lost{background:rgba(244,67,54,.2);color:#F44336}
        .badge-active{background:rgba(0,200,83,.2);color:#00C853}.badge-at-risk{background:rgba(255,179,0,.2);color:#FFB300}
        .priority-high{color:var(--red-light);font-weight:600}.priority-medium{color:var(--warning)}.priority-low{color:var(--text2)}
        .company-link{color:var(--red-light);text-decoration:none;font-weight:500;cursor:pointer}.company-link:hover{text-decoration:underline}
        .stale{color:var(--warning)}.stale-danger{color:var(--red-light)}
        .btn{display:inline-flex;align-items:center;gap:.4rem;padding:.4rem .75rem;border-radius:6px;font-size:.8rem;font-weight:500;cursor:pointer;border:none;font-family:inherit}
        .btn-primary{background:var(--red);color:#fff}.btn-primary:hover{background:var(--red-dark)}
        .btn-secondary{background:var(--input);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{background:var(--elevated)}
        .btn-sm{padding:.25rem .5rem;font-size:.7rem}.action-btns{display:flex;gap:.2rem}
        .kanban-container{display:grid;grid-template-columns:repeat(6,1fr);gap:1rem;min-height:500px}
        .kanban-column{background:var(--card);border:1px solid var(--border);border-radius:8px;display:flex;flex-direction:column}
        .kanban-header{padding:.75rem;border-bottom:1px solid var(--border);text-align:center}
        .kanban-title{font-size:.75rem;font-weight:600;text-transform:uppercase}.kanban-count{font-size:.7rem;color:var(--muted)}.kanban-value{font-size:.7rem;color:var(--red-light);font-family:'JetBrains Mono',monospace}
        .kanban-body{flex:1;padding:.5rem;overflow-y:auto;min-height:400px}
        .kanban-card{background:var(--elevated);border:1px solid var(--border);border-radius:6px;padding:.75rem;margin-bottom:.5rem;cursor:grab}
        .kanban-card:hover{border-color:var(--red)}.kanban-card.dragging{opacity:.5}
        .kanban-card-title{font-weight:600;font-size:.8rem;margin-bottom:.25rem}.kanban-card-meta{font-size:.7rem;color:var(--muted)}
        .kanban-card-value{font-size:.75rem;color:var(--success);font-family:'JetBrains Mono',monospace;margin-top:.25rem}
        .kanban-card-priority{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:.25rem}
        .kanban-card-priority.high{background:var(--red)}.kanban-card-priority.medium{background:var(--warning)}.kanban-card-priority.low{background:var(--muted)}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);z-index:1000;align-items:center;justify-content:center;padding:1rem}
        .modal-overlay.active{display:flex}.modal{background:var(--card);border:1px solid var(--border);border-radius:12px;width:100%;max-width:700px;max-height:90vh;overflow-y:auto}
        .modal-header{padding:1rem 1.25rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--card);z-index:10}
        .modal-title{font-size:1rem;font-weight:600}.modal-close{background:none;border:none;color:var(--text2);font-size:1.5rem;cursor:pointer}
        .modal-body{padding:1.25rem}.modal-footer{padding:1rem 1.25rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:.5rem;position:sticky;bottom:0;background:var(--card)}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.form-group{margin-bottom:.25rem}.form-group.full-width{grid-column:span 2}
        .form-label{display:block;font-size:.65rem;font-weight:500;text-transform:uppercase;color:var(--text2);margin-bottom:.25rem}
        .form-input,.form-select,.form-textarea{width:100%;background:var(--input);border:1px solid var(--border);border-radius:6px;padding:.5rem .75rem;color:var(--text);font-size:.8rem;font-family:inherit}
        .form-input:focus,.form-select:focus{outline:none;border-color:var(--red)}.form-textarea{min-height:60px;resize:vertical}
        .report-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;flex-wrap:wrap;gap:.75rem}
        .report-title{font-size:1.25rem;font-weight:700}.report-tabs{display:flex;gap:.4rem}
        .report-tab{padding:.4rem .75rem;background:var(--card);border:1px solid var(--border);border-radius:6px;color:var(--text2);cursor:pointer;font-size:.8rem;font-weight:500}
        .report-tab:hover{background:var(--elevated)}.report-tab.active{background:var(--red);color:#fff;border-color:var(--red)}
        .report-section{background:var(--card);border:1px solid var(--border);border-radius:8px;margin-bottom:1rem;overflow:hidden}
        .report-section-header{background:var(--elevated);padding:.75rem 1rem;border-bottom:1px solid var(--border);font-weight:600;font-size:.85rem}
        .report-section-body{padding:1rem}
        .report-metrics{display:grid;grid-template-columns:repeat(5,1fr);gap:.75rem;margin-bottom:1rem}
        .report-metric{text-align:center;padding:.75rem;background:var(--elevated);border-radius:8px}
        .report-metric-value{font-size:1.5rem;font-weight:700;font-family:'JetBrains Mono',monospace;color:var(--red-light)}
        .report-metric-label{font-size:.65rem;color:var(--text2);text-transform:uppercase;margin-top:.25rem}
        .report-table{width:100%}.report-table th,.report-table td{padding:.5rem;text-align:left;border-bottom:1px solid var(--border);font-size:.8rem}
        .report-table th{font-size:.65rem;text-transform:uppercase;color:var(--text2)}
        .reference-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
        .reference-card{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}
        .reference-card-header{background:var(--red);padding:.75rem 1rem;font-weight:600;font-size:.85rem}
        .reference-card-body{padding:1rem}.reference-item{padding:.4rem 0;border-bottom:1px solid var(--border);font-size:.8rem}.reference-item:last-child{border-bottom:none}.reference-item strong{color:var(--red-light)}
        .calc-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
        .calc-result{background:var(--elevated);border-radius:8px;padding:1.5rem;text-align:center}
        .calc-result-value{font-size:2.5rem;font-weight:700;font-family:'JetBrains Mono',monospace;color:var(--success)}
        .calc-result-label{font-size:.75rem;color:var(--text2);text-transform:uppercase;margin-top:.5rem}
        .calc-breakdown{margin-top:1rem}.calc-breakdown-item{display:flex;justify-content:space-between;padding:.4rem 0;border-bottom:1px solid var(--border);font-size:.8rem}
        .templates-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
        .template-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem;cursor:pointer}.template-card:hover{border-color:var(--red)}
        .template-title{font-weight:600;font-size:.9rem;margin-bottom:.5rem}.template-preview{font-size:.75rem;color:var(--muted);line-height:1.4}
        .task-item{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--elevated);border-radius:6px;margin-bottom:.5rem}
        .task-checkbox{width:18px;height:18px;border:2px solid var(--border);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .task-checkbox.checked{background:var(--success);border-color:var(--success)}.task-content{flex:1}
        .task-title{font-size:.85rem}.task-title.completed{text-decoration:line-through;color:var(--muted)}
        .task-due{font-size:.7rem;color:var(--muted)}.task-due.overdue{color:var(--red-light)}
        .competitor-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}
        .competitor-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem}
        .competitor-name{font-weight:600;font-size:.9rem;margin-bottom:.5rem}
        .competitor-stat{display:flex;justify-content:space-between;font-size:.75rem;padding:.25rem 0}
        .funnel-container{display:flex;flex-direction:column;align-items:center}
        .funnel-stage{display:flex;align-items:center;justify-content:center;padding:1rem;text-align:center;margin:-1px 0}
        .funnel-stage-name{font-weight:600;font-size:.85rem}.funnel-stage-value{font-family:'JetBrains Mono',monospace;font-size:.8rem}
        .funnel-stage-conversion{font-size:.7rem;color:var(--muted)}
        .import-zone{border:2px dashed var(--border);border-radius:8px;padding:2rem;text-align:center;cursor:pointer}.import-zone:hover{border-color:var(--red)}
        ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
        @media(max-width:1400px){.stats-row{grid-template-columns:repeat(3,1fr)}.charts-grid{grid-template-columns:repeat(2,1fr)}.chart-card.wide{grid-column:span 2}.variables-grid{grid-template-columns:repeat(3,1fr)}.kanban-container{grid-template-columns:repeat(3,1fr)}.report-metrics{grid-template-columns:repeat(3,1fr)}}
        @media(max-width:1024px){.stats-row{grid-template-columns:repeat(2,1fr)}.charts-grid{grid-template-columns:1fr}.chart-card.wide{grid-column:span 1}.dashboard-bottom{grid-template-columns:1fr}.alerts-section{grid-template-columns:1fr}.kanban-container{grid-template-columns:repeat(2,1fr)}.reference-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.form-grid{grid-template-columns:1fr}.form-group.full-width{grid-column:span 1}.kanban-container{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section"><div class="logo">CG</div><div class="brand"><h1>Carroll Group Australia</h1><span>Sales CRM Pro</span></div></div>
            <div class="user-info"><span id="currentDate"></span><div class="user-avatar">JB</div><span>Jordan Brown</span></div>
        </div>
    </header>
    <nav class="nav-tabs"><ul>
        <li><a href="#" class="active" data-tab="dashboard">Dashboard</a></li>
        <li><a href="#" data-tab="pipeline">Pipeline</a></li>
        <li><a href="#" data-tab="prospects">Prospects</a></li>
        <li><a href="#" data-tab="accounts">Accounts</a></li>
        <li><a href="#" data-tab="activities">Activities</a></li>
        <li><a href="#" data-tab="tasks">Tasks</a></li>
        <li><a href="#" data-tab="targets">Targets</a></li>
        <li><a href="#" data-tab="competitors">Competitors</a></li>
        <li><a href="#" data-tab="calculator">Quote Calc</a></li>
        <li><a href="#" data-tab="templates">Templates</a></li>
        <li><a href="#" data-tab="reports">Reports</a></li>
        <li><a href="#" data-tab="analytics">Analytics</a></li>
        <li><a href="#" data-tab="import">Import</a></li>
        <li><a href="#" data-tab="reference">Reference</a></li>
    </ul></nav>
    <main class="main-content">
        <div id="dashboard" class="tab-content active">
            <div class="variables-panel"><div class="variables-header" onclick="toggleVariables()"><span class="chart-title">‚öôÔ∏è Settings & Variables</span><span id="varToggle">‚ñº</span></div>
            <div class="variables-body" id="variablesBody"><div class="variables-grid">
                <div class="var-group"><label>Target Pipeline ($)</label><input type="number" id="varTargetPipeline" value="2000000" onchange="updateVariables()"></div>
                <div class="var-group"><label>Target Win Rate (%)</label><input type="number" id="varTargetWinRate" value="25" onchange="updateVariables()"></div>
                <div class="var-group"><label>Weekly Call Target</label><input type="number" id="varTargetCalls" value="15" onchange="updateVariables()"></div>
                <div class="var-group"><label>Weekly Meeting Target</label><input type="number" id="varTargetMeetings" value="5" onchange="updateVariables()"></div>
                <div class="var-group"><label>Stale Deal Days</label><input type="number" id="varStaleDays" value="14" onchange="updateVariables()"></div>
                <div class="var-group"><label>Avg Sales Cycle</label><input type="number" id="varSalesCycle" value="45" onchange="updateVariables()"></div>
                <div class="var-group"><label>Contract Alert Days</label><input type="number" id="varContractAlert" value="60" onchange="updateVariables()"></div>
                <div class="var-group"><label>Weekly Email Target</label><input type="number" id="varTargetEmails" value="20" onchange="updateVariables()"></div>
                <div class="var-group"><label>Region</label><select id="varRegion" onchange="updateVariables()"><option value="National">National</option><option value="QLD">QLD</option><option value="WA">WA</option></select></div>
                <div class="var-group"><label>FY Start</label><select id="varFYStart" onchange="updateVariables()"><option value="7">July</option><option value="1">January</option></select></div>
            </div></div></div>
            <div class="goals-section"><div style="display:flex;justify-content:space-between;margin-bottom:.75rem"><span class="chart-title">üìä Weekly Activity Goals</span><span id="weekRange" style="font-size:.75rem;color:var(--text2)"></span></div><div class="goals-grid" id="goalsGrid"></div></div>
            <div class="alerts-section">
                <div class="alert-card warning"><div class="alert-title">‚ö†Ô∏è Stale Deals</div><div class="alert-list" id="staleDeals"></div></div>
                <div class="alert-card danger"><div class="alert-title">üîî Contract Renewals</div><div class="alert-list" id="contractAlerts"></div></div>
                <div class="alert-card"><div class="alert-title">üí∞ Revenue at Risk</div><div class="alert-list" id="revenueRisk"></div></div>
            </div>
            <div class="stats-row">
                <div class="stat-card"><div class="stat-label">Pipeline Value</div><div class="stat-value" id="statPipeline">$0</div><div class="stat-change" id="statPipelineChange"></div></div>
                <div class="stat-card success"><div class="stat-label">Weighted Forecast</div><div class="stat-value" id="statForecast">$0</div><div class="stat-change">Probability-weighted</div></div>
                <div class="stat-card warning"><div class="stat-label">Active Prospects</div><div class="stat-value" id="statProspects">0</div></div>
                <div class="stat-card info"><div class="stat-label">Win Rate</div><div class="stat-value" id="statWinRate">0%</div><div class="stat-change" id="statWinRateChange"></div></div>
                <div class="stat-card purple"><div class="stat-label">Avg Sales Velocity</div><div class="stat-value" id="statVelocity">0d</div></div>
                <div class="stat-card orange"><div class="stat-label">Active Accounts</div><div class="stat-value" id="statAccounts">0</div></div>
            </div>
            <div class="charts-grid">
                <div class="chart-card wide"><div class="chart-header"><span class="chart-title">Pipeline by Stage</span></div><div class="chart-body"><canvas id="chartPipeline"></canvas></div></div>
                <div class="chart-card"><div class="chart-header"><span class="chart-title">Sector Breakdown</span></div><div class="chart-body"><canvas id="chartSector"></canvas></div></div>
                <div class="chart-card"><div class="chart-header"><span class="chart-title">Activity This Week</span></div><div class="chart-body"><canvas id="chartActivity"></canvas></div></div>
                <div class="chart-card"><div class="chart-header"><span class="chart-title">Pipeline vs Target</span></div><div class="chart-body"><canvas id="chartTarget"></canvas></div></div>
                <div class="chart-card"><div class="chart-header"><span class="chart-title">Win/Loss Ratio</span></div><div class="chart-body"><canvas id="chartWinLoss"></canvas></div></div>
            </div>
            <div class="dashboard-bottom">
                <div class="section-card"><div class="section-header">üìÖ Upcoming Actions</div><div class="section-body" id="upcomingActions"></div></div>
                <div class="section-card"><div class="section-header">üïí Recent Activities</div><div class="section-body" id="recentActivities"></div></div>
            </div>
        </div>
        <div id="pipeline" class="tab-content"><div style="display:flex;justify-content:space-between;margin-bottom:1rem"><h2 style="font-size:1.25rem">Pipeline Kanban</h2><button class="btn btn-primary" onclick="openModal('prospect')">+ Add Prospect</button></div><div class="kanban-container" id="kanbanBoard"></div></div>
        <div id="prospects" class="tab-content"><div class="table-container"><div class="table-header"><h2 class="table-title">Prospects</h2><div class="table-actions"><input type="text" class="search-input" id="prospectSearch" placeholder="Search..."><select class="search-input" id="prospectFilter" style="width:120px"><option value="">All Stages</option><option value="Lead">Lead</option><option value="Qualified">Qualified</option><option value="Proposal">Proposal</option><option value="Negotiation">Negotiation</option><option value="Won">Won</option><option value="Lost">Lost</option></select><button class="btn btn-primary" onclick="openModal('prospect')">+ Add</button></div></div><div class="table-scroll"><table><thead><tr><th>Company</th><th>Contact</th><th>Sector</th><th>Stage</th><th>Priority</th><th>Value</th><th>Prob.</th><th>Weighted</th><th>Age</th><th>Next Action</th><th>Actions</th></tr></thead><tbody id="prospectsTable"></tbody></table></div></div></div>
        <div id="accounts" class="tab-content"><div class="table-container"><div class="table-header"><h2 class="table-title">Accounts</h2><div class="table-actions"><input type="text" class="search-input" id="accountSearch" placeholder="Search..."><select class="search-input" id="accountFilter" style="width:120px"><option value="">All Status</option><option value="Active">Active</option><option value="At Risk">At Risk</option><option value="Churned">Churned</option></select><button class="btn btn-primary" onclick="openModal('account')">+ Add</button></div></div><div class="table-scroll"><table><thead><tr><th>Company</th><th>Contact</th><th>Sector</th><th>Status</th><th>Revenue</th><th>Contract End</th><th>Days Left</th><th>Risk</th><th>NPS</th><th>Actions</th></tr></thead><tbody id="accountsTable"></tbody></table></div></div></div>
        <div id="activities" class="tab-content"><div class="table-container"><div class="table-header"><h2 class="table-title">Activities</h2><div class="table-actions"><input type="text" class="search-input" id="activitySearch" placeholder="Search..."><select class="search-input" id="activityFilter" style="width:120px"><option value="">All Types</option><option value="Call">Call</option><option value="Meeting">Meeting</option><option value="Email">Email</option><option value="Site Visit">Site Visit</option><option value="Quote Sent">Quote Sent</option></select><button class="btn btn-primary" onclick="openModal('activity')">+ Log Activity</button></div></div><div class="table-scroll"><table><thead><tr><th>Date</th><th>Type</th><th>Company</th><th>Contact</th><th>Subject</th><th>Outcome</th><th>Follow Up</th><th>Actions</th></tr></thead><tbody id="activitiesTable"></tbody></table></div></div></div>
        <div id="tasks" class="tab-content"><div style="display:flex;justify-content:space-between;margin-bottom:1rem"><h2 style="font-size:1.25rem">Tasks & Reminders</h2><button class="btn btn-primary" onclick="openModal('task')">+ Add Task</button></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem"><div class="section-card"><div class="section-header">üî¥ Overdue</div><div class="section-body" id="tasksOverdue"></div></div><div class="section-card"><div class="section-header">üü° Due Today</div><div class="section-body" id="tasksToday"></div></div><div class="section-card"><div class="section-header">üü¢ Upcoming</div><div class="section-body" id="tasksUpcoming"></div></div></div></div>
        <div id="targets" class="tab-content"><div class="table-container"><div class="table-header"><h2 class="table-title">Target Companies</h2><div class="table-actions"><input type="text" class="search-input" id="targetSearch" placeholder="Search..."><button class="btn btn-primary" onclick="openModal('target')">+ Add Target</button></div></div><div class="table-scroll"><table><thead><tr><th>Company</th><th>Sector</th><th>Location</th><th>Opportunity</th><th>Priority</th><th>Competitor</th><th>Strategy</th><th>Status</th><th>Actions</th></tr></thead><tbody id="targetsTable"></tbody></table></div></div></div>
        <div id="competitors" class="tab-content"><div style="display:flex;justify-content:space-between;margin-bottom:1rem"><h2 style="font-size:1.25rem">Competitor Tracker</h2><button class="btn btn-primary" onclick="openModal('competitor')">+ Add Competitor</button></div><div class="competitor-grid" id="competitorGrid"></div><div class="section-card" style="margin-top:1rem"><div class="section-header">üìä Competitive Win/Loss</div><div class="section-body"><canvas id="chartCompetitors" style="height:250px"></canvas></div></div></div>
        <div id="calculator" class="tab-content"><h2 style="font-size:1.25rem;margin-bottom:1rem">Quick Quote Calculator</h2><div class="calc-grid"><div class="section-card"><div class="section-header">Route Details</div><div class="section-body"><div class="form-grid"><div class="form-group"><label class="form-label">Origin</label><select class="form-select" id="calcOrigin"><option>Brisbane</option><option>Yatala</option><option>Gladstone</option><option>Townsville</option><option>Toowoomba</option><option>Perth</option></select></div><div class="form-group"><label class="form-label">Destination</label><select class="form-select" id="calcDest"><option>Perth</option><option>Brisbane</option><option>Sydney</option><option>Melbourne</option><option>Gladstone</option><option>Townsville</option><option>Cairns</option></select></div><div class="form-group"><label class="form-label">Service</label><select class="form-select" id="calcService"><option value="General">General Transport</option><option value="Heavy">Heavy Haulage</option><option value="Linehaul">Linehaul</option><option value="DG">Bulk DG</option><option value="Project">Project Logistics</option></select></div><div class="form-group"><label class="form-label">Equipment</label><select class="form-select" id="calcEquip"><option value="B-Double">B-Double (34 pallets)</option><option value="A-Double">A-Double PBS (36-44 pallets)</option><option value="Semi">Semi (22 pallets)</option><option value="Flat Top">Flat Top</option></select></div><div class="form-group"><label class="form-label">Weight (tonnes)</label><input type="number" class="form-input" id="calcWeight" value="20"></div><div class="form-group"><label class="form-label">Frequency/month</label><select class="form-select" id="calcFreq"><option value="1">One-off</option><option value="4">Weekly</option><option value="12">3x Weekly</option><option value="20">Daily</option></select></div><div class="form-group"><label class="form-label">Fuel Levy (%)</label><input type="number" class="form-input" id="calcFuel" value="15" min="0" max="50"></div><div class="form-group"><label class="form-label">Add GST (10%)</label><select class="form-select" id="calcGST"><option value="yes">Yes</option><option value="no">No</option></select></div><div class="form-group full-width"><button class="btn btn-primary" onclick="calculateQuote()" style="width:100%">Calculate</button></div></div></div></div><div class="section-card"><div class="section-header">Quote Estimate</div><div class="section-body"><div class="calc-result"><div class="calc-result-value" id="calcTotal">$0</div><div class="calc-result-label">Per Load Estimate</div></div><div class="calc-breakdown" id="calcBreakdown"></div></div></div></div></div>
        <div id="templates" class="tab-content"><h2 style="font-size:1.25rem;margin-bottom:1rem">Email & Call Templates</h2><div class="templates-grid" id="templatesGrid"></div></div>
        <div id="reports" class="tab-content"><div class="report-header"><h2 class="report-title">Sales Reports</h2><div class="report-tabs"><button class="report-tab active" data-report="weekly">Weekly</button><button class="report-tab" data-report="monthly">Monthly</button><button class="report-tab" data-report="quarterly">Quarterly</button><button class="report-tab" data-report="ytd">YTD</button></div><button class="btn btn-secondary" onclick="exportReport()">üì• Export</button></div><div id="reportContent"></div></div>
        <div id="analytics" class="tab-content"><h2 style="font-size:1.25rem;margin-bottom:1rem">Sales Analytics</h2><div class="charts-grid"><div class="chart-card wide"><div class="chart-header"><span class="chart-title">Conversion Funnel</span></div><div class="chart-body" id="funnelContainer" style="height:300px"></div></div><div class="chart-card"><div class="chart-header"><span class="chart-title">Sales Velocity by Sector</span></div><div class="chart-body"><canvas id="chartVelocity"></canvas></div></div><div class="chart-card wide"><div class="chart-header"><span class="chart-title">Pipeline Trend</span></div><div class="chart-body"><canvas id="chartTrend"></canvas></div></div><div class="chart-card"><div class="chart-header"><span class="chart-title">Lead Source ROI</span></div><div class="chart-body"><canvas id="chartSources"></canvas></div></div><div class="chart-card wide"><div class="chart-header"><span class="chart-title">Win/Loss Reasons</span></div><div class="chart-body"><canvas id="chartReasons"></canvas></div></div><div class="chart-card"><div class="chart-header"><span class="chart-title">Region Performance</span></div><div class="chart-body"><canvas id="chartRegion"></canvas></div></div></div></div>
        <div id="import" class="tab-content"><h2 style="font-size:1.25rem;margin-bottom:1rem">CSV Import</h2><div class="section-card"><div class="section-header">Import Prospects</div><div class="section-body"><div class="import-zone" id="importZone" onclick="document.getElementById('csvFile').click()"><input type="file" id="csvFile" accept=".csv" style="display:none" onchange="handleCSVImport(event)"><div style="font-size:2rem;margin-bottom:.5rem">üìÅ</div><div>Drop CSV file here or click to upload</div><div style="font-size:.75rem;color:var(--muted);margin-top:.5rem">Required: company, contact, sector, value</div></div><div id="importPreview" style="margin-top:1rem"></div></div></div></div>
        <div id="reference" class="tab-content"><div class="reference-grid"><div class="reference-card"><div class="reference-card-header">Service Offerings</div><div class="reference-card-body"><div class="reference-item"><strong>General Transport</strong> - FTL/LTL, palletised</div><div class="reference-item"><strong>Heavy Haulage</strong> - Oversized, project</div><div class="reference-item"><strong>Linehaul</strong> - Brisbane-Perth, interstate</div><div class="reference-item"><strong>Bulk DG</strong> - Dangerous goods</div><div class="reference-item"><strong>Project Logistics</strong> - End-to-end</div><div class="reference-item"><strong>Warehousing</strong> - Storage</div></div></div><div class="reference-card"><div class="reference-card-header">Fleet Capabilities</div><div class="reference-card-body"><div class="reference-item"><strong>A-Doubles (PBS)</strong> - 30m, 36-44 pallets</div><div class="reference-item"><strong>B-Doubles</strong> - 34 pallets</div><div class="reference-item"><strong>Flat Tops</strong> - Oversized</div><div class="reference-item"><strong>Curtainsiders</strong> - General</div><div class="reference-item"><strong>Prime Movers</strong> - Euro 6</div></div></div><div class="reference-card"><div class="reference-card-header">Key Locations</div><div class="reference-card-body"><div class="reference-item"><strong>Yatala</strong> - Head Office</div><div class="reference-item"><strong>Gladstone</strong> - Regional Hub</div><div class="reference-item"><strong>Perth</strong> - West Coast</div><div class="reference-item"><strong>Townsville</strong> - North QLD</div><div class="reference-item"><strong>Toowoomba</strong> - Darling Downs</div></div></div><div class="reference-card"><div class="reference-card-header">Target Sectors</div><div class="reference-card-body"><div class="reference-item">Mining</div><div class="reference-item">Oil & Gas</div><div class="reference-item">Construction</div><div class="reference-item">Heavy Industrial</div><div class="reference-item">Retail</div><div class="reference-item">Agriculture</div><div class="reference-item">Energy</div></div></div><div class="reference-card"><div class="reference-card-header">Value Props</div><div class="reference-card-body"><div class="reference-item">40+ years experience</div><div class="reference-item">Family-owned, safety culture</div><div class="reference-item">NHVR, HVNL, ISO compliant</div><div class="reference-item">PBS fleet efficiency</div><div class="reference-item">National + local</div></div></div><div class="reference-card"><div class="reference-card-header">Key Contacts</div><div class="reference-card-body"><div class="reference-item"><strong>Troy Carroll</strong> - Director</div><div class="reference-item"><strong>Jordan Brown</strong> - National Sales Manager</div><div class="reference-item"><strong>Barry Thompson</strong> - COO</div><div class="reference-item"><strong>Daniel Knight</strong> - Transport & Compliance</div></div></div></div><div class="section-card" style="margin-top:1rem"><div class="section-header">Service Matcher</div><div class="section-body"><div class="form-grid"><div class="form-group"><label class="form-label">Customer Need</label><select class="form-select" id="matchNeed" onchange="matchService()"><option value="">Select...</option><option value="interstate">Interstate freight</option><option value="oversized">Oversized loads</option><option value="dangerous">Dangerous goods</option><option value="project">Project logistics</option><option value="storage">Storage</option><option value="retail">Retail distribution</option></select></div><div class="form-group"><label class="form-label">Recommended Service</label><input type="text" class="form-input" id="matchResult" readonly></div></div></div></div></div>
    </main>
    <!-- Modals -->
    <div class="modal-overlay" id="prospectModal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="prospectModalTitle">Add Prospect</h3><button class="modal-close" onclick="closeModal('prospect')">&times;</button></div><div class="modal-body"><form id="prospectForm" class="form-grid"><input type="hidden" name="id"><div class="form-group"><label class="form-label">Company *</label><input type="text" class="form-input" name="company" required></div><div class="form-group"><label class="form-label">Contact</label><input type="text" class="form-input" name="contact"></div><div class="form-group"><label class="form-label">Phone</label><input type="text" class="form-input" name="phone"></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" name="email"></div><div class="form-group"><label class="form-label">Sector</label><select class="form-select" name="sector"><option>Mining</option><option>Oil & Gas</option><option>Construction</option><option>Heavy Industrial</option><option>Retail</option><option>Agriculture</option><option>Energy</option></select></div><div class="form-group"><label class="form-label">Stage</label><select class="form-select" name="stage"><option>Lead</option><option>Qualified</option><option>Proposal</option><option>Negotiation</option><option>Won</option><option>Lost</option></select></div><div class="form-group"><label class="form-label">Priority</label><select class="form-select" name="priority"><option>High</option><option>Medium</option><option>Low</option></select></div><div class="form-group"><label class="form-label">Value ($)</label><input type="number" class="form-input" name="value"></div><div class="form-group"><label class="form-label">Probability (%)</label><select class="form-select" name="probability"><option value="10">10% - Lead</option><option value="25">25% - Qualified</option><option value="50">50% - Proposal</option><option value="75">75% - Negotiation</option><option value="100">100% - Won</option><option value="0">0% - Lost</option></select></div><div class="form-group"><label class="form-label">Source</label><select class="form-select" name="source"><option>Cold Call</option><option>Referral</option><option>Website</option><option>LinkedIn</option><option>Industry Event</option><option>Tender</option></select></div><div class="form-group full-width"><label class="form-label">Services</label><input type="text" class="form-input" name="services"></div><div class="form-group"><label class="form-label">Origin</label><input type="text" class="form-input" name="origin"></div><div class="form-group"><label class="form-label">Destination</label><input type="text" class="form-input" name="destination"></div><div class="form-group"><label class="form-label">Competitor</label><input type="text" class="form-input" name="competitor"></div><div class="form-group"><label class="form-label">Region</label><select class="form-select" name="region"><option>QLD</option><option>WA</option><option>NSW</option><option>VIC</option><option>National</option></select></div><div class="form-group"><label class="form-label">Next Action</label><input type="text" class="form-input" name="nextAction"></div><div class="form-group"><label class="form-label">Next Action Date</label><input type="date" class="form-input" name="nextActionDate"></div><div class="form-group"><label class="form-label">Win Reason</label><select class="form-select" name="winReason"><option value="">N/A</option><option>Price</option><option>Service</option><option>Relationship</option><option>Capability</option><option>Speed</option></select></div><div class="form-group"><label class="form-label">Loss Reason</label><select class="form-select" name="lossReason"><option value="">N/A</option><option>Price</option><option>Incumbent</option><option>Capability</option><option>Timing</option><option>Competition</option></select></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('prospect')">Cancel</button><button class="btn btn-primary" onclick="saveProspect()">Save</button></div></div></div>
    <div class="modal-overlay" id="accountModal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="accountModalTitle">Add Account</h3><button class="modal-close" onclick="closeModal('account')">&times;</button></div><div class="modal-body"><form id="accountForm" class="form-grid"><input type="hidden" name="id"><div class="form-group"><label class="form-label">Company *</label><input type="text" class="form-input" name="company" required></div><div class="form-group"><label class="form-label">Contact</label><input type="text" class="form-input" name="contact"></div><div class="form-group"><label class="form-label">Phone</label><input type="text" class="form-input" name="phone"></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" name="email"></div><div class="form-group"><label class="form-label">Sector</label><select class="form-select" name="sector"><option>Mining</option><option>Oil & Gas</option><option>Construction</option><option>Heavy Industrial</option><option>Retail</option><option>Agriculture</option><option>Energy</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" name="status"><option>Active</option><option>At Risk</option><option>Churned</option></select></div><div class="form-group"><label class="form-label">Revenue ($)</label><input type="number" class="form-input" name="revenue"></div><div class="form-group"><label class="form-label">Payment Terms</label><select class="form-select" name="paymentTerms"><option>14 Days</option><option>30 Days</option><option>45 Days</option><option>60 Days</option></select></div><div class="form-group"><label class="form-label">Contract Start</label><input type="date" class="form-input" name="contractStart"></div><div class="form-group"><label class="form-label">Contract End</label><input type="date" class="form-input" name="contractEnd"></div><div class="form-group full-width"><label class="form-label">Services</label><input type="text" class="form-input" name="services"></div><div class="form-group full-width"><label class="form-label">Routes</label><input type="text" class="form-input" name="routes"></div><div class="form-group"><label class="form-label">Risk</label><select class="form-select" name="risk"><option>Low</option><option>Medium</option><option>High</option></select></div><div class="form-group"><label class="form-label">NPS (1-10)</label><input type="number" class="form-input" name="nps" min="1" max="10"></div><div class="form-group full-width"><label class="form-label">Growth Opportunity</label><input type="text" class="form-input" name="growthOpp"></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('account')">Cancel</button><button class="btn btn-primary" onclick="saveAccount()">Save</button></div></div></div>
    <div class="modal-overlay" id="activityModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Log Activity</h3><button class="modal-close" onclick="closeModal('activity')">&times;</button></div><div class="modal-body"><form id="activityForm" class="form-grid"><input type="hidden" name="id"><div class="form-group"><label class="form-label">Date *</label><input type="date" class="form-input" name="date" required></div><div class="form-group"><label class="form-label">Type</label><select class="form-select" name="type"><option>Call</option><option>Meeting</option><option>Email</option><option>Site Visit</option><option>Quote Sent</option></select></div><div class="form-group"><label class="form-label">Company *</label><input type="text" class="form-input" name="company" required list="companyList"><datalist id="companyList"></datalist></div><div class="form-group"><label class="form-label">Contact</label><input type="text" class="form-input" name="contact"></div><div class="form-group full-width"><label class="form-label">Subject</label><input type="text" class="form-input" name="subject"></div><div class="form-group"><label class="form-label">Duration (mins)</label><input type="number" class="form-input" name="duration" value="15"></div><div class="form-group"><label class="form-label">Outcome</label><select class="form-select" name="outcome"><option>Positive</option><option>Neutral</option><option>Negative</option><option>Awaiting</option></select></div><div class="form-group"><label class="form-label">Follow Up</label><input type="date" class="form-input" name="followUp"></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('activity')">Cancel</button><button class="btn btn-primary" onclick="saveActivity()">Save</button></div></div></div>
    <div class="modal-overlay" id="taskModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Add Task</h3><button class="modal-close" onclick="closeModal('task')">&times;</button></div><div class="modal-body"><form id="taskForm" class="form-grid"><input type="hidden" name="id"><div class="form-group full-width"><label class="form-label">Task *</label><input type="text" class="form-input" name="title" required></div><div class="form-group"><label class="form-label">Due Date *</label><input type="date" class="form-input" name="dueDate" required></div><div class="form-group"><label class="form-label">Priority</label><select class="form-select" name="priority"><option>High</option><option>Medium</option><option>Low</option></select></div><div class="form-group"><label class="form-label">Company</label><input type="text" class="form-input" name="company" list="companyList"></div><div class="form-group"><label class="form-label">Category</label><select class="form-select" name="category"><option>Follow Up</option><option>Quote</option><option>Meeting</option><option>Admin</option></select></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('task')">Cancel</button><button class="btn btn-primary" onclick="saveTask()">Save</button></div></div></div>
    <div class="modal-overlay" id="targetModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Add Target</h3><button class="modal-close" onclick="closeModal('target')">&times;</button></div><div class="modal-body"><form id="targetForm" class="form-grid"><input type="hidden" name="id"><div class="form-group"><label class="form-label">Company *</label><input type="text" class="form-input" name="company" required></div><div class="form-group"><label class="form-label">Sector</label><select class="form-select" name="sector"><option>Mining</option><option>Oil & Gas</option><option>Construction</option><option>Heavy Industrial</option><option>Retail</option><option>Agriculture</option><option>Energy</option></select></div><div class="form-group"><label class="form-label">Location</label><input type="text" class="form-input" name="location"></div><div class="form-group"><label class="form-label">Est. Opportunity</label><input type="text" class="form-input" name="opportunity" placeholder="$300K+"></div><div class="form-group"><label class="form-label">Priority</label><select class="form-select" name="priority"><option>High</option><option>Medium</option><option>Low</option></select></div><div class="form-group"><label class="form-label">Decision Maker</label><input type="text" class="form-input" name="decisionMaker"></div><div class="form-group"><label class="form-label">Current Provider</label><input type="text" class="form-input" name="currentProvider"></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" name="status"><option>Not contacted</option><option>Researching</option><option>Contacted</option><option>Meeting scheduled</option></select></div><div class="form-group full-width"><label class="form-label">Strategy</label><input type="text" class="form-input" name="strategy"></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('target')">Cancel</button><button class="btn btn-primary" onclick="saveTarget()">Save</button></div></div></div>
    <div class="modal-overlay" id="competitorModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Add Competitor</h3><button class="modal-close" onclick="closeModal('competitor')">&times;</button></div><div class="modal-body"><form id="competitorForm" class="form-grid"><input type="hidden" name="id"><div class="form-group full-width"><label class="form-label">Name *</label><input type="text" class="form-input" name="name" required></div><div class="form-group full-width"><label class="form-label">Services</label><input type="text" class="form-input" name="services"></div><div class="form-group full-width"><label class="form-label">Strengths</label><textarea class="form-textarea" name="strengths"></textarea></div><div class="form-group full-width"><label class="form-label">Weaknesses</label><textarea class="form-textarea" name="weaknesses"></textarea></div><div class="form-group full-width"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('competitor')">Cancel</button><button class="btn btn-primary" onclick="saveCompetitor()">Save</button></div></div></div>
    <div class="modal-overlay" id="templateViewModal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="templateViewTitle">Template</h3><button class="modal-close" onclick="closeModal('templateView')">&times;</button></div><div class="modal-body"><div id="templateContent" style="white-space:pre-wrap;font-size:.85rem;line-height:1.6;background:var(--elevated);padding:1rem;border-radius:6px"></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('templateView')">Close</button><button class="btn btn-primary" onclick="copyTemplate()">Copy</button></div></div></div>
<script>
let data={prospects:[{id:1,company:'Senex Energy',contact:'Mark Thompson',phone:'07 3000 1234',email:'mthompson@senex.com.au',sector:'Oil & Gas',stage:'Qualified',priority:'High',value:350000,probability:25,services:'Heavy Haulage, Project',origin:'Gladstone',destination:'Surat Basin',competitor:'Toll',source:'Cold Call',nextAction:'Site meeting',nextActionDate:'2025-12-18',notes:'',region:'QLD',winReason:'',lossReason:'',created:'2025-12-01',lastActivity:'2025-12-15'},{id:2,company:'Boral Construction',contact:'Sarah Chen',phone:'07 3100 5678',email:'schen@boral.com.au',sector:'Construction',stage:'Proposal',priority:'High',value:280000,probability:50,services:'General Transport',origin:'Brisbane',destination:'Gold Coast',competitor:'Linfox',source:'Referral',nextAction:'Follow up',nextActionDate:'2025-12-16',notes:'',region:'QLD',winReason:'',lossReason:'',created:'2025-11-15',lastActivity:'2025-12-15'},{id:3,company:'Rio Tinto Weipa',contact:'James Morrison',phone:'07 4000 9876',email:'jmorrison@riotinto.com',sector:'Mining',stage:'Lead',priority:'Medium',value:520000,probability:10,services:'Bulk DG',origin:'Brisbane',destination:'Weipa',competitor:'K&S',source:'Website',nextAction:'Initial call',nextActionDate:'2025-12-20',notes:'',region:'QLD',winReason:'',lossReason:'',created:'2025-12-10',lastActivity:'2025-12-10'},{id:4,company:'Coles Distribution',contact:'Amanda Wright',phone:'08 9000 4321',email:'awright@coles.com.au',sector:'Retail',stage:'Negotiation',priority:'High',value:450000,probability:75,services:'Linehaul',origin:'Brisbane',destination:'Perth',competitor:'SCT',source:'Tender',nextAction:'Contract review',nextActionDate:'2025-12-17',notes:'',region:'National',winReason:'',lossReason:'',created:'2025-10-20',lastActivity:'2025-12-12'},{id:5,company:'GrainCorp',contact:'Peter Williams',phone:'07 4600 7890',email:'pwilliams@graincorp.com.au',sector:'Agriculture',stage:'Qualified',priority:'Medium',value:180000,probability:25,services:'Bulk Transport',origin:'Toowoomba',destination:'Brisbane',competitor:'Local',source:'Industry Event',nextAction:'Quote prep',nextActionDate:'2025-12-19',notes:'',region:'QLD',winReason:'',lossReason:'',created:'2025-11-28',lastActivity:'2025-12-05'},{id:6,company:'Ergon Energy',contact:'David Lee',sector:'Energy',stage:'Won',priority:'High',value:320000,probability:100,services:'Heavy Haulage',region:'QLD',winReason:'Service',lossReason:'',created:'2025-09-15',lastActivity:'2025-12-01'},{id:7,company:'Downer Group',contact:'Michelle Park',sector:'Construction',stage:'Lost',priority:'High',value:400000,probability:0,services:'General',region:'National',winReason:'',lossReason:'Price',created:'2025-08-01',lastActivity:'2025-10-15'}],accounts:[{id:1,company:'Santos GLNG',contact:'David Patterson',phone:'07 3838 5000',sector:'Oil & Gas',status:'Active',revenue:680000,services:'Heavy Haulage',routes:'Brisbane-Gladstone',contractStart:'2024-01-01',contractEnd:'2025-12-31',paymentTerms:'30 Days',risk:'Low',nps:8,growthOpp:'Roma expansion'},{id:2,company:'Wagners Group',contact:'Michael Wagner',phone:'07 4637 9999',sector:'Construction',status:'Active',revenue:420000,services:'General, Oversized',routes:'Toowoomba-Brisbane',contractStart:'2024-07-01',contractEnd:'2026-06-30',paymentTerms:'14 Days',risk:'Low',nps:9,growthOpp:'Wellcamp'},{id:3,company:'Bunnings Warehouse',contact:'Lisa Howard',sector:'Retail',status:'Active',revenue:350000,services:'Linehaul',routes:'Brisbane-Perth',contractStart:'2024-03-01',contractEnd:'2026-02-28',paymentTerms:'30 Days',risk:'Medium',nps:7,growthOpp:'Additional routes'}],activities:[{id:1,date:'2025-12-15',type:'Call',company:'Senex Energy',contact:'Mark Thompson',subject:'Introduction',duration:25,outcome:'Positive',followUp:'2025-12-18',notes:'Interested in safety'},{id:2,date:'2025-12-15',type:'Email',company:'Boral Construction',contact:'Sarah Chen',subject:'Quote follow up',duration:10,outcome:'Awaiting',followUp:'2025-12-17',notes:'Sent pricing'},{id:3,date:'2025-12-14',type:'Meeting',company:'Santos GLNG',contact:'David Patterson',subject:'Quarterly review',duration:60,outcome:'Positive',followUp:'2025-12-29',notes:'Roma expansion'},{id:4,date:'2025-12-13',type:'Site Visit',company:'Wagners Group',contact:'Michael Wagner',subject:'Wellcamp',duration:120,outcome:'Positive',followUp:'',notes:'New requirements'},{id:5,date:'2025-12-12',type:'Call',company:'Coles Distribution',contact:'Amanda Wright',subject:'Contract',duration:45,outcome:'Positive',followUp:'2025-12-17',notes:'Agreed pricing'}],tasks:[{id:1,title:'Follow up Senex quote',dueDate:'2025-12-16',priority:'High',company:'Senex Energy',category:'Follow Up',completed:false},{id:2,title:'Prepare Boral presentation',dueDate:'2025-12-17',priority:'High',company:'Boral Construction',category:'Quote',completed:false},{id:3,title:'Review Santos contract',dueDate:'2025-12-20',priority:'Medium',company:'Santos GLNG',category:'Admin',completed:false}],targets:[{id:1,company:'Origin Energy',sector:'Oil & Gas',location:'Brisbane',opportunity:'$400K+',priority:'High',decisionMaker:'TBC',currentProvider:'Unknown',strategy:'Networking',status:'Not contacted'},{id:2,company:'Glencore Coal',sector:'Mining',location:'Brisbane',opportunity:'$600K+',priority:'High',decisionMaker:'TBC',currentProvider:'Multiple',strategy:'Direct',status:'Not contacted'},{id:3,company:'Hutchinson Builders',sector:'Construction',location:'Brisbane',opportunity:'$300K+',priority:'Medium',decisionMaker:'TBC',currentProvider:'Unknown',strategy:'Referral',status:'Not contacted'}],competitors:[{id:1,name:'Toll',services:'Full service',strengths:'National network',weaknesses:'Higher pricing',wins:1,losses:2},{id:2,name:'Linfox',services:'Warehousing',strengths:'Retail relationships',weaknesses:'Less heavy haulage',wins:0,losses:1},{id:3,name:'SCT Logistics',services:'Rail',strengths:'Cost on long haul',weaknesses:'Limited road',wins:0,losses:1},{id:4,name:'K&S Freighters',services:'General',strengths:'Regional',weaknesses:'Limited PBS',wins:0,losses:0}],templates:[{id:1,name:'Cold Call Intro',type:'Call',content:"Hi [Name], this is Jordan Brown from Carroll Group Australia. We're a family-owned heavy transport company with 40+ years experience.\n\nI noticed [Company] operates in [sector] and wanted to see if you're reviewing logistics arrangements?\n\nWe specialise in [service] with a strong safety record. Would you have 10 minutes this week?"},{id:2,name:'Follow Up Email',type:'Email',content:"Subject: Following up - Carroll Group\n\nHi [Name],\n\nThank you for speaking with me. Carroll Group offers:\n\n‚Ä¢ 40+ years experience\n‚Ä¢ PBS A-Double fleet\n‚Ä¢ NHVR compliant\n‚Ä¢ National coverage\n\nI'll send the quote by [date].\n\nBest regards,\nJordan Brown\nNational Sales Manager"},{id:3,name:'Quote Cover',type:'Email',content:"Subject: Carroll Group Quote - [Route]\n\nHi [Name],\n\nPlease find attached our quote:\n\n‚Ä¢ Route: [Origin] to [Destination]\n‚Ä¢ Service: [Service]\n‚Ä¢ Rate: [Rate]\n\nValid 30 days. Ready to start within [timeframe].\n\nJordan Brown"},{id:4,name:'Meeting Request',type:'Email',content:"Subject: Meeting Request - Transport\n\nHi [Name],\n\nI'd like to discuss how Carroll Group can support [Company].\n\nAgenda:\n1. Current challenges\n2. Our capabilities\n3. Solutions\n4. Next steps\n\nAvailable times:\n‚Ä¢ [Option 1]\n‚Ä¢ [Option 2]\n\nJordan Brown"},{id:5,name:'Lost Deal Follow Up',type:'Email',content:"Subject: Thank you - Carroll Group\n\nHi [Name],\n\nThank you for considering Carroll Group. While unsuccessful this time, please keep us in mind for future projects.\n\nBest wishes,\nJordan Brown"},{id:6,name:'Contract Renewal',type:'Email',content:"Subject: Contract Renewal - [Company]\n\nHi [Name],\n\nYour contract renews on [date]. Over the past period we've delivered:\n\n‚Ä¢ [Achievement 1]\n‚Ä¢ [Achievement 2]\n\nLet's schedule a review meeting.\n\nJordan Brown"}],variables:{targetPipeline:2000000,targetWinRate:25,targetCalls:15,targetMeetings:5,targetEmails:20,staleDays:14,salesCycle:45,fyStart:7,region:'National',contractAlert:60},pipelineHistory:[{month:'2025-07',value:1200000},{month:'2025-08',value:1450000},{month:'2025-09',value:1680000},{month:'2025-10',value:1520000},{month:'2025-11',value:1780000},{month:'2025-12',value:1780000}]};
let charts={};
document.addEventListener('DOMContentLoaded',()=>{loadData();initTabs();initReportTabs();initSearch();renderAll();setCurrentDate();loadVariables();});
function loadData(){const s=localStorage.getItem('carrollCRM_v3');if(s)data=JSON.parse(s);}
function saveData(){localStorage.setItem('carrollCRM_v3',JSON.stringify(data));}
function setCurrentDate(){document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-AU',{weekday:'short',day:'numeric',month:'short',year:'numeric'});}
function initTabs(){document.querySelectorAll('.nav-tabs a').forEach(t=>{t.addEventListener('click',e=>{e.preventDefault();const id=t.dataset.tab;document.querySelectorAll('.nav-tabs a').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));t.classList.add('active');document.getElementById(id).classList.add('active');if(id==='dashboard')setTimeout(renderCharts,100);if(id==='pipeline')renderKanban();if(id==='reports')renderReport('weekly');if(id==='analytics')setTimeout(renderAnalytics,100);if(id==='competitors'){renderCompetitors();setTimeout(renderCompetitorChart,100);}if(id==='templates')renderTemplates();});});}
function initReportTabs(){document.querySelectorAll('.report-tab').forEach(t=>{t.addEventListener('click',()=>{document.querySelectorAll('.report-tab').forEach(x=>x.classList.remove('active'));t.classList.add('active');renderReport(t.dataset.report);});});}
function initSearch(){document.getElementById('prospectSearch').addEventListener('input',renderProspects);document.getElementById('prospectFilter').addEventListener('change',renderProspects);document.getElementById('accountSearch').addEventListener('input',renderAccounts);document.getElementById('accountFilter').addEventListener('change',renderAccounts);document.getElementById('activitySearch').addEventListener('input',renderActivities);document.getElementById('activityFilter').addEventListener('change',renderActivities);document.getElementById('targetSearch').addEventListener('input',renderTargets);}
function toggleVariables(){const b=document.getElementById('variablesBody'),t=document.getElementById('varToggle');b.classList.toggle('open');t.textContent=b.classList.contains('open')?'‚ñ≤':'‚ñº';}
function loadVariables(){const v=data.variables;document.getElementById('varTargetPipeline').value=v.targetPipeline;document.getElementById('varTargetWinRate').value=v.targetWinRate;document.getElementById('varTargetCalls').value=v.targetCalls;document.getElementById('varTargetMeetings').value=v.targetMeetings;document.getElementById('varTargetEmails').value=v.targetEmails;document.getElementById('varStaleDays').value=v.staleDays;document.getElementById('varSalesCycle').value=v.salesCycle;document.getElementById('varFYStart').value=v.fyStart;document.getElementById('varRegion').value=v.region;document.getElementById('varContractAlert').value=v.contractAlert;}
function updateVariables(){data.variables={targetPipeline:parseInt(document.getElementById('varTargetPipeline').value)||2000000,targetWinRate:parseInt(document.getElementById('varTargetWinRate').value)||25,targetCalls:parseInt(document.getElementById('varTargetCalls').value)||15,targetMeetings:parseInt(document.getElementById('varTargetMeetings').value)||5,targetEmails:parseInt(document.getElementById('varTargetEmails').value)||20,staleDays:parseInt(document.getElementById('varStaleDays').value)||14,salesCycle:parseInt(document.getElementById('varSalesCycle').value)||45,fyStart:parseInt(document.getElementById('varFYStart').value)||7,region:document.getElementById('varRegion').value,contractAlert:parseInt(document.getElementById('varContractAlert').value)||60};saveData();renderDashboard();}
function formatCurrency(v){return new Intl.NumberFormat('en-AU',{style:'currency',currency:'AUD',maximumFractionDigits:0}).format(v||0);}
function formatDate(d){return d?new Date(d).toLocaleDateString('en-AU',{day:'2-digit',month:'2-digit',year:'numeric'}):'-';}
function daysBetween(d1,d2){return Math.floor((new Date(d2)-new Date(d1))/(1000*60*60*24));}
function getStageBadge(s){const c={'Lead':'badge-lead','Qualified':'badge-qualified','Proposal':'badge-proposal','Negotiation':'badge-negotiation','Won':'badge-won','Lost':'badge-lost','Active':'badge-active','At Risk':'badge-at-risk'};return c[s]||'';}
function getPriorityClass(p){return`priority-${(p||'medium').toLowerCase()}`;}
function truncate(s,l){return s&&s.length>l?s.substring(0,l)+'...':(s||'-');}
function getWeekRange(){const n=new Date(),d=n.getDay(),s=new Date(n);s.setDate(n.getDate()-d);const e=new Date(s);e.setDate(s.getDate()+6);return{start:s,end:e,label:`${s.toLocaleDateString('en-AU',{day:'numeric',month:'short'})} - ${e.toLocaleDateString('en-AU',{day:'numeric',month:'short'})}`};}
function renderAll(){renderDashboard();renderProspects();renderAccounts();renderActivities();renderTargets();renderTasks();updateCompanyList();}
function updateCompanyList(){const l=document.getElementById('companyList'),c=[...new Set([...data.prospects.map(p=>p.company),...data.accounts.map(a=>a.company)])];l.innerHTML=c.map(x=>`<option value="${x}">`).join('');}
</script>
<script>
function renderDashboard(){const as=['Lead','Qualified','Proposal','Negotiation'],ac=data.prospects.filter(p=>as.includes(p.stage)),pv=ac.reduce((s,p)=>s+(p.value||0),0),wt=ac.reduce((s,p)=>s+((p.value||0)*(p.probability||0)/100),0),wn=data.prospects.filter(p=>p.stage==='Won').length,ls=data.prospects.filter(p=>p.stage==='Lost').length,wr=wn+ls>0?Math.round((wn/(wn+ls))*100):0;
const today=new Date().toISOString().split('T')[0];document.getElementById('statPipeline').textContent=formatCurrency(pv);document.getElementById('statPipelineChange').innerHTML=pv>=data.variables.targetPipeline?'<span class="up">‚úì On target</span>':`<span class="down">${formatCurrency(data.variables.targetPipeline-pv)} below</span>`;document.getElementById('statForecast').textContent=formatCurrency(wt);document.getElementById('statProspects').textContent=ac.length;document.getElementById('statWinRate').textContent=wr+'%';document.getElementById('statWinRateChange').innerHTML=wr>=data.variables.targetWinRate?'<span class="up">‚úì Above target</span>':`<span class="down">${data.variables.targetWinRate-wr}% below</span>`;document.getElementById('statVelocity').textContent=data.variables.salesCycle+'d';document.getElementById('statAccounts').textContent=data.accounts.filter(a=>a.status==='Active').length;
const week=getWeekRange();document.getElementById('weekRange').textContent=week.label;const wa=data.activities.filter(a=>{const d=new Date(a.date);return d>=week.start&&d<=week.end;});const calls=wa.filter(a=>a.type==='Call').length,meetings=wa.filter(a=>a.type==='Meeting').length,emails=wa.filter(a=>a.type==='Email').length,visits=wa.filter(a=>a.type==='Site Visit').length,quotes=wa.filter(a=>a.type==='Quote Sent').length;
document.getElementById('goalsGrid').innerHTML=[{label:'Calls',current:calls,target:data.variables.targetCalls},{label:'Meetings',current:meetings,target:data.variables.targetMeetings},{label:'Emails',current:emails,target:data.variables.targetEmails},{label:'Site Visits',current:visits,target:3},{label:'Quotes',current:quotes,target:5}].map(g=>{const pct=Math.min(100,Math.round((g.current/g.target)*100));return`<div class="goal-item"><div class="goal-label">${g.label}</div><div class="goal-progress"><div class="goal-bar ${pct>=100?'complete':''}" style="width:${pct}%"></div></div><div class="goal-value">${g.current}/${g.target}</div></div>`;}).join('');
const stale=data.prospects.filter(p=>{if(!as.includes(p.stage))return false;const last=new Date(p.lastActivity||p.created);return daysBetween(last,today)>data.variables.staleDays;});document.getElementById('staleDeals').innerHTML=stale.length>0?stale.slice(0,5).map(p=>{const days=daysBetween(p.lastActivity||p.created,today);return`<div class="alert-item"><span>${truncate(p.company,20)}</span><span class="${days>21?'stale-danger':'stale'}">${days}d</span></div>`;}).join(''):'<div style="color:var(--muted);font-size:.75rem">No stale deals</div>';
const ca=data.accounts.filter(a=>{if(!a.contractEnd)return false;const dl=daysBetween(today,a.contractEnd);return dl>=0&&dl<=data.variables.contractAlert;}).sort((a,b)=>new Date(a.contractEnd)-new Date(b.contractEnd));document.getElementById('contractAlerts').innerHTML=ca.length>0?ca.slice(0,5).map(a=>{const d=daysBetween(today,a.contractEnd);return`<div class="alert-item"><span>${truncate(a.company,20)}</span><span class="${d<30?'stale-danger':'stale'}">${d}d</span></div>`;}).join(''):'<div style="color:var(--muted);font-size:.75rem">No renewals</div>';
const ar=data.accounts.filter(a=>a.status==='At Risk'||a.risk==='High'),rv=ar.reduce((s,a)=>s+(a.revenue||0),0);document.getElementById('revenueRisk').innerHTML=ar.length>0?`<div style="font-size:1.25rem;font-weight:700;color:var(--red-light);margin-bottom:.5rem">${formatCurrency(rv)}</div>`+ar.slice(0,4).map(a=>`<div class="alert-item"><span>${truncate(a.company,20)}</span><span>${formatCurrency(a.revenue)}</span></div>`).join(''):'<div style="color:var(--muted);font-size:.75rem">No accounts at risk</div>';
const up=data.prospects.filter(p=>p.nextActionDate).sort((a,b)=>new Date(a.nextActionDate)-new Date(b.nextActionDate)).slice(0,6);document.getElementById('upcomingActions').innerHTML=up.length?up.map(p=>`<div class="activity-item"><div class="activity-icon">üìÖ</div><div class="activity-content"><div class="activity-title">${p.nextAction||'Follow up'}</div><div class="activity-meta">${formatDate(p.nextActionDate)} ¬∑ ${p.company}</div></div></div>`).join(''):'<p style="color:var(--muted);text-align:center;padding:1rem">No actions</p>';
const ic={'Call':'üìû','Meeting':'ü§ù','Email':'‚úâÔ∏è','Site Visit':'üè≠','Quote Sent':'üìÑ'},rc=data.activities.slice(0,6);document.getElementById('recentActivities').innerHTML=rc.length?rc.map(a=>`<div class="activity-item"><div class="activity-icon">${ic[a.type]||'üìå'}</div><div class="activity-content"><div class="activity-title">${a.type} - ${a.company}</div><div class="activity-meta">${formatDate(a.date)} ¬∑ ${a.subject||'-'}</div></div></div>`).join(''):'<p style="color:var(--muted);text-align:center;padding:1rem">No activities</p>';renderCharts();}
function renderCharts(){const co={responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#A0A0A0',font:{size:10}}}},scales:{x:{ticks:{color:'#666'},grid:{color:'#333'}},y:{ticks:{color:'#666'},grid:{color:'#333'}}}};
const st=['Lead','Qualified','Proposal','Negotiation','Won','Lost'],sc=st.map(s=>data.prospects.filter(p=>p.stage===s).length),sv=st.map(s=>data.prospects.filter(p=>p.stage===s).reduce((x,p)=>x+(p.value||0),0));if(charts.pipeline)charts.pipeline.destroy();charts.pipeline=new Chart(document.getElementById('chartPipeline'),{type:'bar',data:{labels:st,datasets:[{label:'Count',data:sc,backgroundColor:['#29B6F6','#FFB300','#AB47BC','#FF7043','#00C853','#F44336'],yAxisID:'y'},{label:'Value',data:sv,type:'line',borderColor:'#C00000',backgroundColor:'transparent',yAxisID:'y1',tension:.3}]},options:{...co,scales:{...co.scales,y:{...co.scales.y,position:'left'},y1:{position:'right',grid:{drawOnChartArea:false},ticks:{color:'#666',callback:v=>'$'+(v/1000)+'k'}}}}});
const se=['Mining','Oil & Gas','Construction','Retail','Agriculture','Energy'],sec=se.map(s=>data.prospects.filter(p=>p.sector===s).length);if(charts.sector)charts.sector.destroy();charts.sector=new Chart(document.getElementById('chartSector'),{type:'doughnut',data:{labels:se,datasets:[{data:sec,backgroundColor:['#C00000','#FF7043','#FFB300','#29B6F6','#00C853','#AB47BC']}]},options:{...co,scales:{}}});
const at=['Call','Meeting','Email','Site Visit','Quote Sent'],week=getWeekRange(),wa=data.activities.filter(a=>{const d=new Date(a.date);return d>=week.start&&d<=week.end;}),atc=at.map(t=>wa.filter(a=>a.type===t).length);if(charts.activity)charts.activity.destroy();charts.activity=new Chart(document.getElementById('chartActivity'),{type:'bar',data:{labels:at,datasets:[{data:atc,backgroundColor:['#29B6F6','#00C853','#FFB300','#AB47BC','#FF7043'],borderRadius:4}]},options:{...co,indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#666'},grid:{color:'#333'}},y:{ticks:{color:'#A0A0A0'},grid:{display:false}}}}});
const as=['Lead','Qualified','Proposal','Negotiation'],cp=data.prospects.filter(p=>as.includes(p.stage)).reduce((s,p)=>s+(p.value||0),0);if(charts.target)charts.target.destroy();charts.target=new Chart(document.getElementById('chartTarget'),{type:'doughnut',data:{labels:['Current','Remaining'],datasets:[{data:[cp,Math.max(0,data.variables.targetPipeline-cp)],backgroundColor:['#C00000','#333'],borderWidth:0}]},options:{...co,scales:{},cutout:'75%'}});
const wn=data.prospects.filter(p=>p.stage==='Won').length,ls=data.prospects.filter(p=>p.stage==='Lost').length;if(charts.winLoss)charts.winLoss.destroy();charts.winLoss=new Chart(document.getElementById('chartWinLoss'),{type:'doughnut',data:{labels:['Won','Lost'],datasets:[{data:[wn,ls],backgroundColor:['#00C853','#F44336'],borderWidth:0}]},options:{...co,scales:{},cutout:'60%'}});}
function renderKanban(){const stages=['Lead','Qualified','Proposal','Negotiation','Won','Lost'],probs={Lead:10,Qualified:25,Proposal:50,Negotiation:75,Won:100,Lost:0};document.getElementById('kanbanBoard').innerHTML=stages.map(stage=>{const prospects=data.prospects.filter(p=>p.stage===stage),value=prospects.reduce((s,p)=>s+(p.value||0),0);return`<div class="kanban-column" data-stage="${stage}"><div class="kanban-header"><div class="kanban-title">${stage}</div><div class="kanban-count">${prospects.length} deals</div><div class="kanban-value">${formatCurrency(value)}</div></div><div class="kanban-body" data-stage="${stage}" ondragover="allowDrop(event)" ondrop="drop(event)">${prospects.map(p=>`<div class="kanban-card" draggable="true" ondragstart="drag(event)" data-id="${p.id}"><div class="kanban-card-title"><span class="kanban-card-priority ${(p.priority||'medium').toLowerCase()}"></span>${p.company}</div><div class="kanban-card-meta">${p.contact||'No contact'}</div><div class="kanban-card-value">${formatCurrency(p.value)}</div><div class="kanban-card-meta">${p.probability||probs[stage]}%</div></div>`).join('')}</div></div>`;}).join('');}
function allowDrop(e){e.preventDefault();}function drag(e){e.dataTransfer.setData('text',e.target.dataset.id);e.target.classList.add('dragging');}
function drop(e){e.preventDefault();const id=parseInt(e.dataTransfer.getData('text')),stage=e.currentTarget.dataset.stage,p=data.prospects.find(x=>x.id===id);if(p){const probs={Lead:10,Qualified:25,Proposal:50,Negotiation:75,Won:100,Lost:0};p.stage=stage;p.probability=probs[stage];p.lastActivity=new Date().toISOString().split('T')[0];saveData();renderKanban();renderDashboard();}}
function renderProspects(){const s=document.getElementById('prospectSearch').value.toLowerCase(),f=document.getElementById('prospectFilter').value,probs={Lead:10,Qualified:25,Proposal:50,Negotiation:75,Won:100,Lost:0},today=new Date().toISOString().split('T')[0],fl=data.prospects.filter(p=>(!s||p.company.toLowerCase().includes(s)||(p.contact||'').toLowerCase().includes(s))&&(!f||p.stage===f));document.getElementById('prospectsTable').innerHTML=fl.map(p=>{const prob=p.probability||probs[p.stage]||0,weighted=(p.value||0)*prob/100,age=daysBetween(p.created,today),staleClass=daysBetween(p.lastActivity||p.created,today)>data.variables.staleDays?'stale':'';return`<tr class="${staleClass}"><td><span class="company-link" onclick="editProspect(${p.id})">${p.company}</span></td><td>${p.contact||'-'}</td><td>${p.sector}</td><td><span class="badge ${getStageBadge(p.stage)}">${p.stage}</span></td><td><span class="${getPriorityClass(p.priority)}">${p.priority}</span></td><td>${formatCurrency(p.value)}</td><td>${prob}%</td><td>${formatCurrency(weighted)}</td><td>${age}d</td><td>${p.nextAction?`${truncate(p.nextAction,12)}<br><small>${formatDate(p.nextActionDate)}</small>`:'-'}</td><td class="action-btns"><button class="btn btn-sm btn-secondary" onclick="editProspect(${p.id})">‚úèÔ∏è</button><button class="btn btn-sm btn-secondary" onclick="logActivityFor('${p.company}','${p.contact||''}')">üìû</button><button class="btn btn-sm btn-secondary" onclick="deleteProspect(${p.id})">üóëÔ∏è</button></td></tr>`;}).join('');}
function renderAccounts(){const s=document.getElementById('accountSearch').value.toLowerCase(),f=document.getElementById('accountFilter').value,today=new Date().toISOString().split('T')[0],fl=data.accounts.filter(a=>(!s||a.company.toLowerCase().includes(s))&&(!f||a.status===f));document.getElementById('accountsTable').innerHTML=fl.map(a=>{const dl=a.contractEnd?daysBetween(today,a.contractEnd):'-',dc=typeof dl==='number'&&dl<30?'stale-danger':(typeof dl==='number'&&dl<60?'stale':'');return`<tr><td><span class="company-link" onclick="editAccount(${a.id})">${a.company}</span></td><td>${a.contact||'-'}</td><td>${a.sector}</td><td><span class="badge ${getStageBadge(a.status)}">${a.status}</span></td><td>${formatCurrency(a.revenue)}</td><td>${formatDate(a.contractEnd)}</td><td class="${dc}">${dl}${typeof dl==='number'?'d':''}</td><td><span class="${getPriorityClass(a.risk)}">${a.risk}</span></td><td>${a.nps||'-'}</td><td class="action-btns"><button class="btn btn-sm btn-secondary" onclick="editAccount(${a.id})">‚úèÔ∏è</button><button class="btn btn-sm btn-secondary" onclick="logActivityFor('${a.company}','${a.contact||''}')">üìû</button><button class="btn btn-sm btn-secondary" onclick="deleteAccount(${a.id})">üóëÔ∏è</button></td></tr>`;}).join('');}
function renderActivities(){const s=document.getElementById('activitySearch').value.toLowerCase(),f=document.getElementById('activityFilter').value,fl=data.activities.filter(a=>(!s||a.company.toLowerCase().includes(s)||(a.subject||'').toLowerCase().includes(s))&&(!f||a.type===f));document.getElementById('activitiesTable').innerHTML=fl.map(a=>`<tr><td>${formatDate(a.date)}</td><td>${a.type}</td><td>${a.company}</td><td>${a.contact||'-'}</td><td>${truncate(a.subject,25)}</td><td>${a.outcome}</td><td>${formatDate(a.followUp)}</td><td class="action-btns"><button class="btn btn-sm btn-secondary" onclick="editActivity(${a.id})">‚úèÔ∏è</button><button class="btn btn-sm btn-secondary" onclick="deleteActivity(${a.id})">üóëÔ∏è</button></td></tr>`).join('');}
function renderTasks(){const today=new Date().toISOString().split('T')[0],overdue=data.tasks.filter(t=>!t.completed&&t.dueDate<today),todayTasks=data.tasks.filter(t=>!t.completed&&t.dueDate===today),upcoming=data.tasks.filter(t=>!t.completed&&t.dueDate>today);const renderTask=t=>`<div class="task-item"><div class="task-checkbox ${t.completed?'checked':''}" onclick="toggleTask(${t.id})">${t.completed?'‚úì':''}</div><div class="task-content"><div class="task-title ${t.completed?'completed':''}">${t.title}</div><div class="task-due ${t.dueDate<today&&!t.completed?'overdue':''}">${formatDate(t.dueDate)} ¬∑ ${t.company||'General'}</div></div><button class="btn btn-sm btn-secondary" onclick="deleteTask(${t.id})">üóëÔ∏è</button></div>`;document.getElementById('tasksOverdue').innerHTML=overdue.length?overdue.map(renderTask).join(''):'<p style="color:var(--muted);text-align:center;padding:1rem;font-size:.8rem">None</p>';document.getElementById('tasksToday').innerHTML=todayTasks.length?todayTasks.map(renderTask).join(''):'<p style="color:var(--muted);text-align:center;padding:1rem;font-size:.8rem">None</p>';document.getElementById('tasksUpcoming').innerHTML=upcoming.length?upcoming.slice(0,10).map(renderTask).join(''):'<p style="color:var(--muted);text-align:center;padding:1rem;font-size:.8rem">None</p>';}
function toggleTask(id){const t=data.tasks.find(x=>x.id===id);if(t){t.completed=!t.completed;saveData();renderTasks();}}
function renderTargets(){const s=document.getElementById('targetSearch').value.toLowerCase(),fl=data.targets.filter(t=>!s||t.company.toLowerCase().includes(s));document.getElementById('targetsTable').innerHTML=fl.map(t=>`<tr><td><span class="company-link" onclick="editTarget(${t.id})">${t.company}</span></td><td>${t.sector}</td><td>${t.location||'-'}</td><td>${t.opportunity||'-'}</td><td><span class="${getPriorityClass(t.priority)}">${t.priority}</span></td><td>${t.currentProvider||'-'}</td><td>${truncate(t.strategy,20)}</td><td>${t.status}</td><td class="action-btns"><button class="btn btn-sm btn-primary" onclick="convertToProspect(${t.id})">‚Üí</button><button class="btn btn-sm btn-secondary" onclick="editTarget(${t.id})">‚úèÔ∏è</button><button class="btn btn-sm btn-secondary" onclick="deleteTarget(${t.id})">üóëÔ∏è</button></td></tr>`).join('');}
function renderCompetitors(){document.getElementById('competitorGrid').innerHTML=data.competitors.map(c=>`<div class="competitor-card"><div class="competitor-name">${c.name}</div><div class="competitor-stat"><span>Win vs us:</span><span style="color:var(--red-light)">${c.losses||0}</span></div><div class="competitor-stat"><span>Loss to us:</span><span style="color:var(--success)">${c.wins||0}</span></div><div style="margin-top:.5rem;font-size:.75rem;color:var(--muted)">${truncate(c.services,40)}</div><button class="btn btn-sm btn-secondary" style="margin-top:.5rem" onclick="editCompetitor(${c.id})">Edit</button></div>`).join('');}
function renderCompetitorChart(){const names=data.competitors.map(c=>c.name),wins=data.competitors.map(c=>c.wins||0),losses=data.competitors.map(c=>-(c.losses||0));if(charts.competitors)charts.competitors.destroy();charts.competitors=new Chart(document.getElementById('chartCompetitors'),{type:'bar',data:{labels:names,datasets:[{label:'We Won',data:wins,backgroundColor:'#00C853'},{label:'They Won',data:losses,backgroundColor:'#F44336'}]},options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{labels:{color:'#A0A0A0'}}},scales:{x:{ticks:{color:'#666'},grid:{color:'#333'}},y:{ticks:{color:'#A0A0A0'},grid:{display:false}}}}});}
function renderTemplates(){document.getElementById('templatesGrid').innerHTML=data.templates.map(t=>`<div class="template-card" onclick="viewTemplate(${t.id})"><div class="template-title">${t.type==='Call'?'üìû':'‚úâÔ∏è'} ${t.name}</div><div class="template-preview">${truncate(t.content,100)}</div></div>`).join('');}
function viewTemplate(id){const t=data.templates.find(x=>x.id===id);if(t){document.getElementById('templateViewTitle').textContent=t.name;document.getElementById('templateContent').textContent=t.content;document.getElementById('templateViewModal').classList.add('active');}}
function copyTemplate(){navigator.clipboard.writeText(document.getElementById('templateContent').textContent);alert('Copied!');}
</script>
<script>
function calculateQuote(){const routes={'Brisbane-Perth':4000,'Brisbane-Sydney':900,'Brisbane-Melbourne':1700,'Brisbane-Gladstone':550,'Brisbane-Townsville':1350,'Brisbane-Cairns':1700,'Yatala-Perth':4000,'Perth-Brisbane':4000},origin=document.getElementById('calcOrigin').value,dest=document.getElementById('calcDest').value,service=document.getElementById('calcService').value,equip=document.getElementById('calcEquip').value,weight=parseInt(document.getElementById('calcWeight').value)||20,freq=parseInt(document.getElementById('calcFreq').value)||1,fuelPct=parseFloat(document.getElementById('calcFuel').value)||15,addGST=document.getElementById('calcGST').value==='yes',key=`${origin}-${dest}`,revKey=`${dest}-${origin}`,distance=routes[key]||routes[revKey]||2000;let base=distance*2.8;const sm={General:1,Heavy:1.5,Linehaul:.9,DG:1.4,Project:1.6},em={'B-Double':1,'A-Double':.85,Semi:1.3,'Flat Top':1.2};base*=sm[service]||1;base*=em[equip]||1;if(weight>25)base*=1.1;if(freq>=12)base*=.9;if(freq>=20)base*=.85;const fuel=base*(fuelPct/100),subtotal=base+fuel,gst=addGST?subtotal*0.1:0,total=subtotal+gst;document.getElementById('calcTotal').textContent=formatCurrency(total);document.getElementById('calcBreakdown').innerHTML=`<div class="calc-breakdown-item"><span>Base (${distance}km)</span><span>${formatCurrency(base)}</span></div><div class="calc-breakdown-item"><span>Fuel Levy (${fuelPct}%)</span><span>${formatCurrency(fuel)}</span></div><div class="calc-breakdown-item"><span>Subtotal (ex GST)</span><span>${formatCurrency(subtotal)}</span></div>${addGST?`<div class="calc-breakdown-item"><span>GST (10%)</span><span>${formatCurrency(gst)}</span></div>`:''}<div class="calc-breakdown-item" style="font-weight:700;border-top:2px solid var(--border);padding-top:.5rem"><span>Total ${addGST?'(inc GST)':'(ex GST)'}</span><span>${formatCurrency(total)}</span></div><div class="calc-breakdown-item"><span>Monthly (${freq*4} loads)</span><span>${formatCurrency(total*freq*4)}</span></div><div class="calc-breakdown-item"><span>Annual Est.</span><span>${formatCurrency(total*freq*52)}</span></div>`;}
function renderReport(period){const now=new Date();let startDate,endDate,periodLabel;if(period==='weekly'){const day=now.getDay();startDate=new Date(now);startDate.setDate(now.getDate()-day);endDate=new Date(startDate);endDate.setDate(startDate.getDate()+6);periodLabel='This Week';}else if(period==='monthly'){startDate=new Date(now.getFullYear(),now.getMonth(),1);endDate=new Date(now.getFullYear(),now.getMonth()+1,0);periodLabel=now.toLocaleDateString('en-AU',{month:'long',year:'numeric'});}else if(period==='quarterly'){const q=Math.floor(now.getMonth()/3);startDate=new Date(now.getFullYear(),q*3,1);endDate=new Date(now.getFullYear(),q*3+3,0);periodLabel=`Q${q+1} ${now.getFullYear()}`;}else{const fy=now.getMonth()>=6?now.getFullYear():now.getFullYear()-1;startDate=new Date(fy,6,1);endDate=now;periodLabel=`FY${fy}/${fy+1} YTD`;}const pa=data.activities.filter(a=>{const d=new Date(a.date);return d>=startDate&&d<=endDate;}),as=['Lead','Qualified','Proposal','Negotiation'],pv=data.prospects.filter(x=>as.includes(x.stage)).reduce((s,x)=>s+(x.value||0),0),wv=data.prospects.filter(x=>x.stage==='Won').reduce((s,x)=>s+(x.value||0),0),wt=data.prospects.filter(x=>as.includes(x.stage)).reduce((s,x)=>s+((x.value||0)*(x.probability||0)/100),0),wn=data.prospects.filter(x=>x.stage==='Won').length,ls=data.prospects.filter(x=>x.stage==='Lost').length,wr=wn+ls>0?Math.round((wn/(wn+ls))*100):0,abt={};pa.forEach(a=>{abt[a.type]=(abt[a.type]||0)+1;});const pbs={};data.prospects.forEach(x=>{pbs[x.sector]=(pbs[x.sector]||0)+1;});const bySource={};data.prospects.forEach(p=>{bySource[p.source]=(bySource[p.source]||0)+1;});const wonBySource={};data.prospects.filter(p=>p.stage==='Won').forEach(p=>{wonBySource[p.source]=(wonBySource[p.source]||0)+1;});document.getElementById('reportContent').innerHTML=`<div class="report-section"><div class="report-section-header">üìä ${periodLabel} Summary</div><div class="report-section-body"><div class="report-metrics"><div class="report-metric"><div class="report-metric-value">${formatCurrency(pv)}</div><div class="report-metric-label">Pipeline</div></div><div class="report-metric"><div class="report-metric-value">${formatCurrency(wt)}</div><div class="report-metric-label">Weighted</div></div><div class="report-metric"><div class="report-metric-value">${formatCurrency(wv)}</div><div class="report-metric-label">Won</div></div><div class="report-metric"><div class="report-metric-value">${wr}%</div><div class="report-metric-label">Win Rate</div></div><div class="report-metric"><div class="report-metric-value">${pa.length}</div><div class="report-metric-label">Activities</div></div></div></div></div><div class="report-section"><div class="report-section-header">üìà Pipeline by Stage</div><div class="report-section-body"><table class="report-table"><thead><tr><th>Stage</th><th>Count</th><th>Value</th><th>Weighted</th></tr></thead><tbody>${['Lead','Qualified','Proposal','Negotiation','Won','Lost'].map(st=>{const probs={Lead:10,Qualified:25,Proposal:50,Negotiation:75,Won:100,Lost:0},c=data.prospects.filter(x=>x.stage===st).length,v=data.prospects.filter(x=>x.stage===st).reduce((s,x)=>s+(x.value||0),0),w=data.prospects.filter(x=>x.stage===st).reduce((s,x)=>s+((x.value||0)*(x.probability||probs[st])/100),0);return`<tr><td><span class="badge ${getStageBadge(st)}">${st}</span></td><td>${c}</td><td>${formatCurrency(v)}</td><td>${formatCurrency(w)}</td></tr>`;}).join('')}</tbody></table></div></div><div class="report-section"><div class="report-section-header">üéØ Activity</div><div class="report-section-body"><table class="report-table"><thead><tr><th>Type</th><th>Count</th></tr></thead><tbody>${Object.entries(abt).map(([t,c])=>`<tr><td>${t}</td><td>${c}</td></tr>`).join('')||'<tr><td colspan="2" style="text-align:center;color:var(--muted)">None</td></tr>'}</tbody></table></div></div><div class="report-section"><div class="report-section-header">üìä Lead Source</div><div class="report-section-body"><table class="report-table"><thead><tr><th>Source</th><th>Leads</th><th>Won</th><th>Conv</th></tr></thead><tbody>${Object.entries(bySource).map(([src,cnt])=>{const wonCnt=wonBySource[src]||0,conv=cnt>0?Math.round((wonCnt/cnt)*100):0;return`<tr><td>${src}</td><td>${cnt}</td><td>${wonCnt}</td><td>${conv}%</td></tr>`;}).join('')}</tbody></table></div></div><div class="report-section"><div class="report-section-header">üè¢ Accounts</div><div class="report-section-body"><table class="report-table"><thead><tr><th>Account</th><th>Status</th><th>Revenue</th><th>Contract End</th><th>Risk</th></tr></thead><tbody>${data.accounts.map(a=>`<tr><td>${a.company}</td><td><span class="badge ${getStageBadge(a.status)}">${a.status}</span></td><td>${formatCurrency(a.revenue)}</td><td>${formatDate(a.contractEnd)}</td><td><span class="${getPriorityClass(a.risk)}">${a.risk}</span></td></tr>`).join('')}</tbody></table></div></div>`;}
function exportReport(){const content=document.getElementById('reportContent').innerText,blob=new Blob([content],{type:'text/plain'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download=`Carroll_Report_${new Date().toISOString().split('T')[0]}.txt`;a.click();}
function renderAnalytics(){const co={responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#A0A0A0',font:{size:10}}}},scales:{x:{ticks:{color:'#666'},grid:{color:'#333'}},y:{ticks:{color:'#666'},grid:{color:'#333'}}}};const stages=['Lead','Qualified','Proposal','Negotiation','Won'],counts=stages.map(s=>data.prospects.filter(p=>p.stage===s||stages.indexOf(p.stage)>stages.indexOf(s)).length),colors=['#29B6F6','#FFB300','#AB47BC','#FF7043','#00C853'];let funnelHTML='<div class="funnel-container">';stages.forEach((s,i)=>{const width=100-(i*15),conv=i>0&&counts[i-1]>0?Math.round((counts[i]/counts[i-1])*100):100;funnelHTML+=`<div class="funnel-stage" style="width:${width}%;background:${colors[i]}"><div class="funnel-stage-name">${s}</div><div class="funnel-stage-value">${counts[i]}</div>${i>0?`<div class="funnel-stage-conversion">${conv}%</div>`:''}</div>`;});funnelHTML+='</div>';document.getElementById('funnelContainer').innerHTML=funnelHTML;
const sectors=['Mining','Oil & Gas','Construction','Retail','Agriculture','Energy'],velocities=sectors.map(s=>{const won=data.prospects.filter(p=>p.sector===s&&p.stage==='Won');return won.length===0?0:Math.round(won.reduce((sum,p)=>sum+daysBetween(p.created,p.lastActivity||new Date().toISOString().split('T')[0]),0)/won.length);});if(charts.velocity)charts.velocity.destroy();charts.velocity=new Chart(document.getElementById('chartVelocity'),{type:'bar',data:{labels:sectors,datasets:[{label:'Days',data:velocities,backgroundColor:'#C00000',borderRadius:4}]},options:{...co,plugins:{legend:{display:false}}}});
const months=data.pipelineHistory.map(h=>h.month),values=data.pipelineHistory.map(h=>h.value);if(charts.trend)charts.trend.destroy();charts.trend=new Chart(document.getElementById('chartTrend'),{type:'line',data:{labels:months,datasets:[{label:'Pipeline',data:values,borderColor:'#C00000',backgroundColor:'rgba(192,0,0,0.1)',fill:true,tension:.3}]},options:co});
const sources=['Cold Call','Referral','Website','LinkedIn','Industry Event','Tender'],srcCounts=sources.map(s=>data.prospects.filter(p=>p.source===s).length);if(charts.sources)charts.sources.destroy();charts.sources=new Chart(document.getElementById('chartSources'),{type:'doughnut',data:{labels:sources,datasets:[{data:srcCounts,backgroundColor:['#C00000','#00C853','#29B6F6','#FFB300','#AB47BC','#FF7043']}]},options:{...co,scales:{}}});
const winReasons={},lossReasons={};data.prospects.filter(p=>p.stage==='Won'&&p.winReason).forEach(p=>{winReasons[p.winReason]=(winReasons[p.winReason]||0)+1;});data.prospects.filter(p=>p.stage==='Lost'&&p.lossReason).forEach(p=>{lossReasons[p.lossReason]=(lossReasons[p.lossReason]||0)+1;});const allReasons=[...new Set([...Object.keys(winReasons),...Object.keys(lossReasons)])];if(charts.reasons)charts.reasons.destroy();charts.reasons=new Chart(document.getElementById('chartReasons'),{type:'bar',data:{labels:allReasons.length>0?allReasons:['No data'],datasets:[{label:'Won',data:allReasons.map(r=>winReasons[r]||0),backgroundColor:'#00C853'},{label:'Lost',data:allReasons.map(r=>-(lossReasons[r]||0)),backgroundColor:'#F44336'}]},options:co});
const regions=['QLD','WA','NSW','VIC','National'],regValues=regions.map(r=>data.prospects.filter(p=>p.region===r).reduce((s,p)=>s+(p.value||0),0));if(charts.region)charts.region.destroy();charts.region=new Chart(document.getElementById('chartRegion'),{type:'bar',data:{labels:regions,datasets:[{label:'Pipeline',data:regValues,backgroundColor:'#C00000',borderRadius:4}]},options:{...co,plugins:{legend:{display:false}}}});}
function handleCSVImport(e){const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(ev){const lines=ev.target.result.split('\n'),headers=lines[0].split(',').map(h=>h.trim().toLowerCase()),prospects=[];for(let i=1;i<lines.length;i++){if(!lines[i].trim())continue;const values=lines[i].split(','),p={id:Date.now()+i,stage:'Lead',priority:'Medium',probability:10,created:new Date().toISOString().split('T')[0],lastActivity:new Date().toISOString().split('T')[0]};headers.forEach((h,j)=>{const v=values[j]?values[j].trim().replace(/^"|"$/g,''):'';if(h==='company')p.company=v;else if(h==='contact')p.contact=v;else if(h==='sector')p.sector=v;else if(h==='value')p.value=parseInt(v)||0;else if(h==='phone')p.phone=v;else if(h==='email')p.email=v;});if(p.company)prospects.push(p);}document.getElementById('importPreview').innerHTML=`<div style="background:var(--elevated);padding:1rem;border-radius:6px"><strong>${prospects.length} prospects found</strong><br><br>${prospects.slice(0,5).map(p=>`‚Ä¢ ${p.company} - ${p.contact||'-'} - ${formatCurrency(p.value)}`).join('<br>')}<br>${prospects.length>5?`<br>...and ${prospects.length-5} more`:''}}<br><br><button class="btn btn-primary" onclick="confirmImport()">Import All</button></div>`;window.pendingImport=prospects;};reader.readAsText(file);}
function confirmImport(){if(window.pendingImport){data.prospects=[...data.prospects,...window.pendingImport];saveData();renderAll();document.getElementById('importPreview').innerHTML='<div style="color:var(--success);padding:1rem">‚úì Imported!</div>';window.pendingImport=null;}}
function matchService(){const need=document.getElementById('matchNeed').value,matches={interstate:'Linehaul - Brisbane-Perth',oversized:'Heavy Haulage - Flat tops',dangerous:'Bulk DG - Licensed DG',project:'Project Logistics - End-to-end',storage:'Warehousing - Short/long term',retail:'General Transport - B-doubles'};document.getElementById('matchResult').value=matches[need]||'';}
function openModal(type,id=null){document.getElementById(`${type}Modal`).classList.add('active');const form=document.getElementById(`${type}Form`);if(form){form.reset();form.querySelector('[name="id"]').value='';}if(type==='activity')document.querySelector('#activityForm [name="date"]').value=new Date().toISOString().split('T')[0];if(type==='task')document.querySelector('#taskForm [name="dueDate"]').value=new Date().toISOString().split('T')[0];}
function closeModal(type){document.getElementById(`${type}Modal`).classList.remove('active');}
function saveProspect(){const f=document.getElementById('prospectForm'),fd=new FormData(f),id=fd.get('id'),p={id:id?parseInt(id):Date.now(),company:fd.get('company'),contact:fd.get('contact'),phone:fd.get('phone'),email:fd.get('email'),sector:fd.get('sector'),stage:fd.get('stage'),priority:fd.get('priority'),value:parseInt(fd.get('value'))||0,probability:parseInt(fd.get('probability'))||10,services:fd.get('services'),origin:fd.get('origin'),destination:fd.get('destination'),competitor:fd.get('competitor'),source:fd.get('source'),region:fd.get('region'),nextAction:fd.get('nextAction'),nextActionDate:fd.get('nextActionDate'),notes:fd.get('notes'),winReason:fd.get('winReason'),lossReason:fd.get('lossReason'),created:id?data.prospects.find(x=>x.id===parseInt(id))?.created:new Date().toISOString().split('T')[0],lastActivity:new Date().toISOString().split('T')[0]};if(id){const i=data.prospects.findIndex(x=>x.id===parseInt(id));if(i>=0)data.prospects[i]=p;}else data.prospects.push(p);saveData();renderAll();renderKanban();closeModal('prospect');}
function editProspect(id){const p=data.prospects.find(x=>x.id===id);if(!p)return;openModal('prospect',id);const f=document.getElementById('prospectForm');Object.keys(p).forEach(k=>{const i=f.querySelector(`[name="${k}"]`);if(i)i.value=p[k]||'';});}
function deleteProspect(id){if(confirm('Delete?')){data.prospects=data.prospects.filter(p=>p.id!==id);saveData();renderAll();renderKanban();}}
function saveAccount(){const f=document.getElementById('accountForm'),fd=new FormData(f),id=fd.get('id'),a={id:id?parseInt(id):Date.now(),company:fd.get('company'),contact:fd.get('contact'),phone:fd.get('phone'),email:fd.get('email'),sector:fd.get('sector'),status:fd.get('status'),revenue:parseInt(fd.get('revenue'))||0,paymentTerms:fd.get('paymentTerms'),services:fd.get('services'),routes:fd.get('routes'),contractStart:fd.get('contractStart'),contractEnd:fd.get('contractEnd'),risk:fd.get('risk'),nps:parseInt(fd.get('nps'))||null,growthOpp:fd.get('growthOpp'),notes:fd.get('notes')};if(id){const i=data.accounts.findIndex(x=>x.id===parseInt(id));if(i>=0)data.accounts[i]=a;}else data.accounts.push(a);saveData();renderAll();closeModal('account');}
function editAccount(id){const a=data.accounts.find(x=>x.id===id);if(!a)return;openModal('account',id);const f=document.getElementById('accountForm');Object.keys(a).forEach(k=>{const i=f.querySelector(`[name="${k}"]`);if(i)i.value=a[k]||'';});}
function deleteAccount(id){if(confirm('Delete?')){data.accounts=data.accounts.filter(a=>a.id!==id);saveData();renderAll();}}
function saveActivity(){const f=document.getElementById('activityForm'),fd=new FormData(f),id=fd.get('id'),a={id:id?parseInt(id):Date.now(),date:fd.get('date'),type:fd.get('type'),company:fd.get('company'),contact:fd.get('contact'),subject:fd.get('subject'),duration:parseInt(fd.get('duration'))||0,outcome:fd.get('outcome'),followUp:fd.get('followUp'),notes:fd.get('notes')};if(id){const i=data.activities.findIndex(x=>x.id===parseInt(id));if(i>=0)data.activities[i]=a;}else{data.activities.unshift(a);const p=data.prospects.find(x=>x.company===a.company);if(p)p.lastActivity=a.date;}saveData();renderAll();closeModal('activity');}
function editActivity(id){const a=data.activities.find(x=>x.id===id);if(!a)return;openModal('activity',id);const f=document.getElementById('activityForm');Object.keys(a).forEach(k=>{const i=f.querySelector(`[name="${k}"]`);if(i)i.value=a[k]||'';});}
function deleteActivity(id){if(confirm('Delete?')){data.activities=data.activities.filter(a=>a.id!==id);saveData();renderAll();}}
function logActivityFor(c,co){openModal('activity');document.querySelector('#activityForm [name="company"]').value=c;document.querySelector('#activityForm [name="contact"]').value=co;}
function saveTask(){const f=document.getElementById('taskForm'),fd=new FormData(f),id=fd.get('id'),t={id:id?parseInt(id):Date.now(),title:fd.get('title'),dueDate:fd.get('dueDate'),priority:fd.get('priority'),company:fd.get('company'),category:fd.get('category'),completed:false,notes:fd.get('notes')};if(id){const i=data.tasks.findIndex(x=>x.id===parseInt(id));if(i>=0)data.tasks[i]=t;}else data.tasks.push(t);saveData();renderTasks();closeModal('task');}
function deleteTask(id){data.tasks=data.tasks.filter(t=>t.id!==id);saveData();renderTasks();}
function saveTarget(){const f=document.getElementById('targetForm'),fd=new FormData(f),id=fd.get('id'),t={id:id?parseInt(id):Date.now(),company:fd.get('company'),sector:fd.get('sector'),location:fd.get('location'),opportunity:fd.get('opportunity'),priority:fd.get('priority'),decisionMaker:fd.get('decisionMaker'),currentProvider:fd.get('currentProvider'),strategy:fd.get('strategy'),status:fd.get('status'),notes:fd.get('notes')};if(id){const i=data.targets.findIndex(x=>x.id===parseInt(id));if(i>=0)data.targets[i]=t;}else data.targets.push(t);saveData();renderTargets();closeModal('target');}
function editTarget(id){const t=data.targets.find(x=>x.id===id);if(!t)return;openModal('target',id);const f=document.getElementById('targetForm');Object.keys(t).forEach(k=>{const i=f.querySelector(`[name="${k}"]`);if(i)i.value=t[k]||'';});}
function deleteTarget(id){if(confirm('Delete?')){data.targets=data.targets.filter(t=>t.id!==id);saveData();renderTargets();}}
function convertToProspect(id){const t=data.targets.find(x=>x.id===id);if(!t)return;const p={id:Date.now(),company:t.company,contact:t.decisionMaker||'',sector:t.sector,stage:'Lead',priority:t.priority,value:0,probability:10,origin:t.location,competitor:t.currentProvider,source:'Target List',notes:t.notes,region:'QLD',created:new Date().toISOString().split('T')[0],lastActivity:new Date().toISOString().split('T')[0]};data.prospects.push(p);data.targets=data.targets.filter(x=>x.id!==id);saveData();renderAll();document.querySelector('[data-tab="prospects"]').click();}
function saveCompetitor(){const f=document.getElementById('competitorForm'),fd=new FormData(f),id=fd.get('id'),c={id:id?parseInt(id):Date.now(),name:fd.get('name'),services:fd.get('services'),strengths:fd.get('strengths'),weaknesses:fd.get('weaknesses'),notes:fd.get('notes'),wins:id?data.competitors.find(x=>x.id===parseInt(id))?.wins||0:0,losses:id?data.competitors.find(x=>x.id===parseInt(id))?.losses||0:0};if(id){const i=data.competitors.findIndex(x=>x.id===parseInt(id));if(i>=0)data.competitors[i]=c;}else data.competitors.push(c);saveData();renderCompetitors();renderCompetitorChart();closeModal('competitor');}
function editCompetitor(id){const c=data.competitors.find(x=>x.id===id);if(!c)return;openModal('competitor',id);const f=document.getElementById('competitorForm');Object.keys(c).forEach(k=>{const i=f.querySelector(`[name="${k}"]`);if(i)i.value=c[k]||'';});}
document.getElementById('importZone').addEventListener('dragover',e=>{e.preventDefault();e.currentTarget.classList.add('dragover');});
document.getElementById('importZone').addEventListener('dragleave',e=>{e.currentTarget.classList.remove('dragover');});
document.getElementById('importZone').addEventListener('drop',e=>{e.preventDefault();e.currentTarget.classList.remove('dragover');const file=e.dataTransfer.files[0];if(file&&file.name.endsWith('.csv')){document.getElementById('csvFile').files=e.dataTransfer.files;handleCSVImport({target:{files:e.dataTransfer.files}});}});
</script>
</body>
</html>
